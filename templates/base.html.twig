<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>{% block title %}{% endblock %}</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
        <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css">
        <link rel="stylesheet" href="https://cdn.datatables.net/fixedheader/3.1.7/css/fixedHeader.bootstrap.min.css">
        <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.4/css/responsive.bootstrap.min.css">
        <link rel="stylesheet" href="{{ asset('css/dash.css') }}">
    </head>
    <body>
    {# load #}
    <div class="containers">
        <div class="yellow bull"></div>
        <div class="red bull"></div>
        <div class="blue bull"></div>
        <div class="violet bull"></div>
    </div>

    {# / load #}

        <section class="vbox">
                    <header class="bg-dark dk header navbar navbar-fixed-top-xs">
                        <div class="navbar-header aside-md">
                            <a class="btn btn-link visible-xs" data-toggle="class:nav-off-screen,open" data-target="#nav,html">
                                <i class="fa fa-bars"></i>
                            </a>
                            <a href="#" class="navbar-brand" data-toggle="fullscreen">TRANOMBAROTRA RASOLONDRAINIBE</a>
                            <a class="btn btn-link visible-xs" id="btn_menu" data-toggle="class:nav-off-screen,open" data-target="#nav,html">
                                <i class="fa fa-times"></i>
                            </a>
                            <a href="{{ path('app_logout')}}" class="btn btn-link visible-xs" id="deconnexion_resp">
                                <i class="fa fa-power-off"></i>
                            </a>
                        </div>
                        <ul class="nav navbar-nav navbar-right m-n hidden-xs nav-user">
                            <li class="dropdown">
                                <a href="{{ path('app_logout') }}" id="deconnexion">
                                    <span>Se déconnecter</span>
                                </a>
                            </li>
                        </ul>
                    </header>
                <section>
                    <section class="hbox stretch">
                        <!-- .aside -->
                       
                            <aside class="bg-dark lter aside-md hidden-print" id="nav">
                            <section class="vbox">
                                <section class="w-f scrollable">
                                    <div class="slim-scroll" data-height="auto" data-disable-fade-out="true" data-distance="0" data-size="5px" data-color="#333333">
                                        <!-- nav -->
                                        <nav class="nav-primary hidden-xs">
                                            <ul class="nav">
                                                <li class="li_profil">
                                                    <a href="#" class="active">
                                                        <i class="fa fa-user icon">
                                                        </i> <span>{{ app.user.nom }}</span>
                                                    </a>
                                                </li>
                                                <li {% if is_granted('ROLE_ADMIN') %}
                                                    style = "display:block;"
                                                    
                                                    {% else %}
                                                    style = "display:none;"

                                                {% endif %}>
                                                    <a href="{{ path('editeurs') }}">
                                                        <i class="fa  fa-users icon">
                                                            
                                                        </i>
                                                        <span>Les éditeurs</span>
                                                    </a>
                                                <li>
                                                    <a href="#layout">
                                                        <i class="fa fa-pencil icon">
                                                            
                                                        </i>
                                                        <span class="pull-right">
                                                            <i class="fa fa-angle-down text"></i>
                                                            <i class="fa fa-angle-up text-active"></i>
                                                        </span>
                                                        <span>Editer</span>
                                                    </a>
                                                    <ul class="nav lt">
                                                        <li>
                                                            <a href="{{ path('register_client') }}">
                                                                <i class="fa fa-angle-right"></i>
                                                                <span>Ajouter</span>
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a href="{{ path('liste_client_de_user', {'user_id': app.user.id }) }}">
                                                                <i class="fa fa-angle-right"></i>
                                                                <span>Lister</span>
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </li>
                                                <li {% if is_granted('ROLE_ADMIN') %}
                                                    style = "display:block;"
                                                    
                                                    {% else %}
                                                    style = "display:none;"

                                                {% endif %}
                                                >
                                                    <a href="#uikit">
                                                        <i class="fa fa-check icon"></i>
                                                        <span class="pull-right">
                                                            <i class="fa fa-angle-down text"></i>
                                                            <i class="fa fa-angle-up text-active"></i>
                                                        </span>
                                                        <span>Control</span>
                                                    </a>
                                                    <ul class="nav lt">
                                                        <li>
                                                            <a href="{{ path('client_nouveau') }}">
                                                                <b class="badge bg-info pull-right">{{ nouveau }}</b>
                                                                <i class="fa fa-angle-right"></i> <span>Nouveau client</span>
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a href="{{ path('client_attente') }}">
                                                                <b class="badge bg-info pull-right">{{ attente }}</b>
                                                                <i class="fa fa-angle-right"></i> <span>Client en attente</span>
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a href="{{ path('client_present') }}">
                                                                <b class="badge bg-info pull-right">{{ present }}</b>
                                                                <i class="fa fa-angle-right"></i> <span>Client présent</span>
                                                            </a>
                                                        </li>
                                                         <li>
                                                            <a href="{{ path('client_paye') }}">
                                                                <b class="badge bg-info pull-right">{{ pointed }}</b>
                                                                <i class="fa fa-angle-right"></i> <span>Client pointé</span>
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a href="{{ path('client_impaye') }}">
                                                                <b class="badge bg-info pull-right">{{ archived }}</b>
                                                                <i class="fa fa-angle-right"></i> <span>Client archivé</span>
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a href="{{ path('client_suspendu') }}">
                                                                <b class="badge bg-info pull-right">{{ suspendu }}</b>
                                                                <i class="fa fa-angle-right"></i> <span>Client suspendu</span>
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a href="{{ path('client_impaye') }}">
                                                                <b class="badge bg-info pull-right">{{ impaye }}</b>
                                                                <i class="fa fa-angle-right"></i> <span>Client classé impayé</span>
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </li>
                                                <li {% if is_granted('ROLE_ADMIN') %}
                                                    style = "display:block;"
                                                    
                                                    {% else %}
                                                    style = "display:none;"

                                                {% endif %}
                                                >
                                                    <a href="#">
                                                        <i class="fa fa-paperclip icon">
                                                        
                                                        </i> <span>Fichier</span>
                                                    </a>
                                                </li>
                                                <li {% if is_granted('ROLE_ADMIN') %}
                                                    style = "display:block;"
                                                    
                                                    {% else %}
                                                    style = "display:none;"

                                                {% endif %}
                                                >
                                                    <a href="{{ path('pointage') }}">
                                                        <i class="fa  fa-pied-piper-alt icon">
                                                        
                                                        </i> <span>Pointage</span>
                                                    </a>
                                                </li>
                                                <li {% if is_granted('ROLE_ADMIN') %}
                                                    style = "display:block;"
                                                    
                                                    {% else %}
                                                    style = "display:none;"

                                                {% endif %}
                                                >
                                                    <a href="{{ path('graph') }}">
                                                        <i class="fa fa-bar-chart-o icon">
                                                        
                                                        </i> <span>Evaluation graphique</span>
                                                    </a>
                                                </li>

                                            </ul>
                                        </nav>
                                         <div class="div__form" {% if is_granted('ROLE_ADMIN') %}
                                         style = "display:block;"
                                         
                                         {% else %}
                                         style = "display:none;"

                                     {% endif %}>
                                                <form action="">
                                                <input type="text" placeholder="Rechercher un matricule">
                                                <a href="#" class="btn btn-primary btn btn-xs"><i class="fa fa-search"></i></a>
                                                </form>
                                            </div>
                                        <!-- / nav -->
                                    </div>
                                </section>


                            </section>
                        </aside>
                        <!-- /.aside -->
                        <section id="content">
                            <section class="vbox">

                                <section class="scrollable padder">


                                    <div style="height:800px;">
                                            {% block body %}
                                                
                                            {% endblock %}
                                    </div>
                                    {# modal suppr  #}
                                        <div id="modal_suppression">
                                            <section class="inner_modal">
                                                <h3 class="modal_titre">Voulez-vous vraiment supprimer ce client?</h3>
                                                <div class="modal_liste_btn">
                                                    <form>
                                                        <input type="hidden" value="">
                                                        <div class="form-group">
                                                            <button data-id-client="0" class="btn btn-primary btn-sm" id="btn_supprimer_client"  type="submit">Supprimer</button>
                                                            <a href="#"  class="btn btn-danger annuler_suppression btn-sm">Annuler</a>
                                                        </div>
                                                    </form>
                                                </div>
                                            </section>
                                        </div>
                                        <div id="modal_modification">
                                            <section class="inner_modal">
                                                <div class="modal_head">
                                                    <button class="btn btn-danger">
                                                        <span class="fa fa-times"></span>
                                                    </button>
                                                    <h3>
                                                        <span>Matricule:</span>
                                                        <span class="son_matricule">123</span>
                                                    </h3>
                                                    <div class="last_etat">
                                                        <span>Dernier mois pointé:
                                                        </span>
                                                        <span class="last_mois">Fevrier
                                                        </span>/<span>
                                                            2020</span>
                                                    </div>
                                                </div>
                                                <form action="">
                                                    <div class="form-group row">
                                                        <div class="col-sm-6">
                                                            <label for="annee">Année:</label>
                                                            <select name="annee_pointage" id="annee_pointage" class="form-control"></select>
                                                        </div>
                                                        <div class="col-sm-6">
                                                            <label for="annee">Mois:</label>
                                                            <select name="mois_pointage" id="mois_pointage" class="form-control">
                                                                <option value="1">Janvier</option>
                                                                <option value="2">Février</option>
                                                                <option value="3">Mars</option>
                                                                <option value="4">Avril</option>
                                                                <option value="5">Mais</option>
                                                                <option value="6">Juin</option>
                                                                <option value="7">Juillet</option>
                                                                <option value="8">Août</option>
                                                                <option value="9">Septembre</option>
                                                                <option value="10">Octobre</option>
                                                                <option value="11">Novembre</option>
                                                                <option value="12">décembre</option>
                                                            </select>
                                                        </div>
                                                        <div class="form-group btn_action">
                                                            <div class="form-group">
                                                                <label>Montant (ariary):</label>
                                                                <input type="number" class="form-control montant" name="montant" id="montant">
                                                            </div>
                                                            <div id="info">
                                                                <p>Lorem ipsum dolor sit amet consectetur adipis</p>
                                                            </div>
                                                            <div class="form-group">
                                                                <button type="sumbit" data-id-client="0" id="add_pointage" class="btn btn-primary btn-sm">Enregistrer</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </form>
                                                <div class="block_details">
                                                    <div class="col-sm-6">
                                                        <div class="form-group">
                                                            <label for="">Nombre de mois restant:</label>
                                                            <p class="details_client">12
                                                                <span>mois</span>
                                                            </p>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <div class="form-group">
                                                            <label for="">Montant total restant:</label>
                                                            <p class="details_clientl">12 000<span>Ariary</span>
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </section>
                                        </div>
                                    {# /modal suppr #}
                                    
                                </section>
                            </section>
                            <a href="#" class="hide nav-off-screen-block" data-toggle="class:nav-off-screen" data-target="#nav"></a>
                        </section>

                    </section>
                </section>
            </section>
        
    

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" 
    integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
    <script src="{{ asset('js/dash.js') }}"></script>
    <script src="{{ asset('js/main.js') }}"></script>
    <script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/fixedheader/3.1.7/js/dataTables.fixedHeader.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.4/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.4/js/responsive.bootstrap.min.js"></script>
    <script>
    $(window).load(function() {
        // Animate loader off screen
        $('.bull').css("animation-play-state", "paused");
        $("div.containers").fadeOut("slow");
        
    });
    $(document).ready(function(){


            /* pointage */

                // function generate year

            function generateYear() {
                var today = new Date();
                //alert(today);
                var y = today.getFullYear();
                //alert(y);
                var html = "<option value = '" + y + "'>" + y + "</option>";
                for (var index = 2009; index < y + 3; index++) {
                    html += "<option value = '" + index + "'>" + index + "</option>";
                }
                $('#annee_pointage').append(html);
            }
            generateYear();

            // animation modal 

            function show_modal(){
                $('#modal_pointage').css('display', 'flex');
                $('.inner_modal').css('transform' , 'scale(1)');
            }
             function hide_modal(){
				 $(".clicked").removeClass('clicked');
                $('#modal_pointage').css('display', 'none');
                $('.inner_modal').css('transform' , 'scale(0)');
				$('#info p').slideUp();
            }

            // activation du modal 
           $('tbody').on('click', '.pointer', function(e){
			   	e.preventDefault();
				$(this).addClass('clicked');
				$('#add_pointage').attr('data-id-client',$(this).attr('data-id-client'));
				show_modal();
		   })
			$('#add_pointage').click(function(e){
				e.preventDefault();
				var id_client = $(this).attr('data-id-client');
				var id_pointage = $('#id_pointage').val();
				var montant = $('#montant').val();

				//alert('id_client:'+id_client+' id_pointage:'+id_pointage+'montant:'+montant);
				var data = {
					'pointage_id' : id_pointage,
					'montant_mensuel' : montant,
					'client_id' : id_client
				}
				// ajax
				$.ajax({
					url : "/admin/pointer_client",
					type : "POST",
					data : data,
					success : function(response){
						/*if(response=="0"){
							window.location.href = "{{ path('pointage') }}";
						}
						else{
							alert('Le montant entré n\'est incorrect ')
                        }*/
                        alert(response);
					},
					error : function(){
						alert('erreur ajax');
					}
				})

			})

            // hide modal 

            $('.modal_head button').click(function(e){
                e.preventDefault();
                hide_modal();
			})


            /* /pointage */


        // animation modal 

            function show_modal_suppression(){
                $('#modal_suppression').css('display', 'flex');
                $('.inner_modal').css('transform' , 'scale(1)');
            }
             function hide_modal_suppression(){
				 //$(".clicked").removeClass('clicked');
                $('#modal_suppression').css('display', 'none');
                $('.inner_modal').css('transform' , 'scale(0)');
			}
			
			 // hide modal 
            $('.annuler_suppression').click(function(e){
				e.preventDefault();
                hide_modal_suppression();
			})

			$('.suppr').click(function(e){
				e.preventDefault();
				var id = $(this).attr('data-id-client');
				//alert(id);
				// on pose ce id dans le bouton suppr
				$("#btn_supprimer_client").attr('data-id-client',id);
				show_modal_suppression();

			})
			$('#btn_supprimer_client').click(function(e){
				e.preventDefault();
				var id = $(this).attr('data-id-client')
				// ajax : 
				$.ajax({
					url :"/admin/supprimer_client/"+id,
					type : "POST",
					data : {
						"action":"suppression",
					},
					beforeSend : function(){
						$('#btn_supprimer_client').text('Suppression du client en cours');
					},
					success: function(response){
						$('#btn_supprimer_client').text("Supprimer")
					},
					error: function(){
						alert('erreur ajax');
					},
					complete: function(){
						location.reload();
					}

				})
			})
    })
       
    </script>
        {% block javascripts %}{% endblock %}
    </body>
</html>
