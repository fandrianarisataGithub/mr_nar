{% extends "base.html.twig" %}
{% block title %}
	Les éditeurs
{% endblock %}
{% block body %}
	<div class="titre_page">
		<h2>Etude graphique</h2>
	</div>


	<div class="container">
        <div class="row">
             <form action="" id="form_tri_annee">
				<select name="annee_pointage" id="annee_pointage" class="form-control"></select>
            </form>
        </div>
        <div>
            <canvas id="canvas_car"></canvas>
        </div>
        <div id="chart-legends_car"></div>
	</div>


{% endblock %}
{% block javascripts %}
	 <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
  <script>
    // function generate year

           

function draw_chart2() {

    var ctx2 = document.getElementById('canvas_car').getContext("2d");


// var gradientstroke = ctx.createLinearGradient(700, 0, 0, 0);
// gradientstroke.addColorStop(0, '#00d8c0');
// gradientstroke.addColorStop(1, '#ff6a72');

var gradientfill_1 = ctx2.createLinearGradient(0, 0, 0, 320);
gradientfill_1.addColorStop(0, '#d29e00');
gradientfill_1.addColorStop(1, 'transparent');

var gradientfill_2 = ctx2.createLinearGradient(0, 0, 0, 320);
gradientfill_2.addColorStop(0, '#55d8ff');
gradientfill_2.addColorStop(1, 'transparent');

var gradientfill_3 = ctx2.createLinearGradient(0, 0, 0, 350);
gradientfill_3.addColorStop(0, '#3bc40a');
gradientfill_3.addColorStop(1, 'transparent');


var gradientfill_4 = ctx2.createLinearGradient(0, 0, 0, 350);
gradientfill_4.addColorStop(0, '#6e6e6e');
gradientfill_4.addColorStop(1, 'transparent');

var config2 = {
    type: 'line',
    data: {
        datasets: [{
            label: "Clients présent",
            fill: true,
            backgroundColor: gradientfill_1,
            borderColor: "#d29e00",

            /* insertion des données sur l'axe (oy) */

            data: [1525,984,1832,355,1850,1715,1365,884,732,175,980,955],

            /* / insertion des données sur l'axe (oy) */

            pointStyle: 'circle' ,
            pointBackgroundColor :"transparent" ,
            pointBorderWidth: '2' ,
            radius:'5',
            hoverRadius :'5',
            borderWidth : 2,

        }, {
            label: "Clients reglo",
            fill: true,
            backgroundColor: gradientfill_2,
            borderColor: "#55d8ff",

            /* insertion des données sur l'axe (oy) */

            data: [860,485,765,923,1278,533,822,1045,1565,1923,1778,1633],

            /* /insertion des données sur l'axe (oy) */

            pointStyle: 'circle',
            pointBackgroundColor :"transparent" ,
            pointBorderWidth: '2' ,
            radius:'5',
            hoverRadius :'5',
            borderWidth : 2,
        },
        {
            label: "Clients classés impayés",
            fill: true,
            backgroundColor: gradientfill_3,
            borderColor: "#3bc40a",

            /* insertion des données sur l'axe (oy) */

            data: [800,805,1002,303,608,833,1122,1440,1660,1920,1570,990],

            /* insertion des données sur l'axe (oy) */

            pointStyle: 'circle',
            pointBackgroundColor :"transparent" ,
            pointBorderWidth: '2' ,
            radius:'5',
            hoverRadius :'5',
            borderWidth : 2,
        },
        {
            label: "Client suspendu",
            fill: true,
            backgroundColor: gradientfill_4,
            borderColor: "#6e6e6e",

            /* insertion des données sur l'axe (oy) */

            data: [220,535,600,703,208,430,502,835,1055,1258,1508,963],

            /* / insertion des données sur l'axe (oy) */

            pointStyle: 'circle',
            pointBackgroundColor :"transparent" ,
            pointBorderWidth: '2' ,
            radius:'5',
            hoverRadius :'5',
            borderWidth : 2,
        }]
    },
    options: {
        legend : {
            display : false ,
            align : 'start' ,
            position : 'bottom'  ,

        },
        
        legendCallback: function(chart) {
            var text = [];
            text.push('<ul class="my_liste_legend ul_2">');
            for (var i=0; i<chart.data.datasets.length; i++) {
              console.log(chart.data.datasets[i]); // see what's inside the obj.
              text.push('<li>');
              text.push('<span data_leg = "'+i+'" style="background-color:' + chart.data.datasets[i].borderColor + '">' + '</span><b data_leg = "'+i+'">'+chart.data.datasets[i].label+'</b>');
              text.push('</li>');
          }
          text.push('</ul>');
          return text.join("");
        },
        responsive: true,
        title:{
            display:true,
            text:''
        },
        tooltips: {
            mode: 'index',
            intersect: false,
        },  
        hover: {
            mode: 'nearest',
            intersect: true
        },

        scales: {

            xAxes: [{
                type: 'category',

                /* insertion des données sur l'axe (ox) */

                labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul","Aug","Sept","Oct","Nov","Dec"],

                /* / insertion des données sur l'axe (ox) */

                gridLines: {
                   drawOnChartArea: true,
                   drawTicks: false ,
                   color : "#f0f2f4",
               } ,

               ticks: {
                          padding: 20 // pour le marge % axe x 
                      }
                  }],
                  yAxes: [{
                    gridLines: {
                       drawOnChartArea: true,
                       drawTicks: false ,
                       color : "#dddfe1",
                   } ,
                   ticks: {
                            padding: 20 ,// pour le marge % axe y
                            min: 0,
                            max: 2000,
                            stepSize : 200,
                            callback: function(value){return value+ " Clients"}
                        },
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: ''
                        }
                    }]
                }
            }

        } ;
        // si on veut ajouter un marge bottom des legendes
        // Chart.Legend.prototype.afterFit = function() {
        //     this.height = this.height + 150;

        // };
        var myChart2 = new Chart(ctx2,config2 );
        // pour dire qu'on va utiliser notre propre légende html fenitra 
        document.getElementById('chart-legends_car').innerHTML = myChart2.generateLegend();

        // legende 1 

        var ev_click = false ;
         var tab_temp = [] ;
         for(var i = 0 ; i< myChart2.data.datasets[0].data.length ; i++) {
                //myChart2.data.datasets[0].data[i]= -10;
                tab_temp[i] = myChart2.data.datasets[0].data[i] ;
             }
        $("#chart-legends_car").on('click', "li span[data_leg=0]", function() {
          
          if(ev_click==false) {
             $(".ul_2 li span[data_leg=0]").addClass("legende_click");
             for(var i = 0 ; i< myChart2.data.datasets[0].data.length ; i++) {
                myChart2.data.datasets[0].data[i] = -10 ;
             }
              myChart2.update();
              ev_click= !ev_click ;
              //alert(ev_click) ;
          }
          else {
             $(".ul_2 li span[data_leg=0]").removeClass("legende_click");
              for(var i = 0 ; i< myChart2.data.datasets[0].data.length ; i++) {
                myChart2.data.datasets[0].data[i] = tab_temp[i] ;
             }
              myChart2.update();
              ev_click= !ev_click ;
              //alert(ev_click) ;
          }
        });

        // fin legende 1

        // legende 2 

        var ev_click2 = false ;
         var tab_temp2 = [] ;
         for(var i = 0 ; i< myChart2.data.datasets[1].data.length ; i++) {
                //myChart2.data.datasets[0].data[i]= -10;
                tab_temp2[i] = myChart2.data.datasets[1].data[i] ;
             }
        $("#chart-legends_car").on('click', "li span[data_leg=1]", function() {
          
          if(ev_click2==false) {
             $(".ul_2 li span[data_leg=1]").addClass("legende_click");
             for(var i = 0 ; i< myChart2.data.datasets[1].data.length ; i++) {
                myChart2.data.datasets[1].data[i] = -10 ;
             }
              myChart2.update();
              ev_click2= !ev_click2 ;
              //alert(ev_click2) ;
          }
          else {
             $(".ul_2 li span[data_leg=1]").removeClass("legende_click");
              for(var i = 0 ; i< myChart2.data.datasets[1].data.length ; i++) {
                myChart2.data.datasets[1].data[i] = tab_temp2[i] ;
             }
              myChart2.update();
              ev_click2= !ev_click2 ;
              //alert(ev_click2) ;
          }
        });

        // fin legende 2

        // legende 3 

        var ev_click3 = false ;
         var tab_temp3 = [] ;
         for(var i = 0 ; i< myChart2.data.datasets[2].data.length ; i++) {
                //myChart2.data.datasets[0].data[i]= -10;
                tab_temp3[i] = myChart2.data.datasets[2].data[i] ;
             }
        $("#chart-legends_car").on('click', "li span[data_leg=2]", function() {
          
          if(ev_click3==false) {
             $(".ul_2 li span[data_leg=2]").addClass("legende_click");
             for(var i = 0 ; i< myChart2.data.datasets[2].data.length ; i++) {
                myChart2.data.datasets[2].data[i] = -10 ;
             }
              myChart2.update();
              ev_click3= !ev_click3 ;
              //alert(ev_click3) ;
          }
          else {
             $(".ul_2 li span[data_leg=2]").removeClass("legende_click");
              for(var i = 0 ; i< myChart2.data.datasets[2].data.length ; i++) {
                myChart2.data.datasets[2].data[i] = tab_temp3[i] ;
             }
              myChart2.update();
              ev_click3= !ev_click3 ;
              //alert(ev_click3) ;
          }
        });

        // fin legende 3

        // legende 4 

        var ev_click4 = false ;
         var tab_temp4 = [] ;
         for(var i = 0 ; i< myChart2.data.datasets[3].data.length ; i++) {
                //myChart2.data.datasets[0].data[i]= -10;
                tab_temp4[i] = myChart2.data.datasets[3].data[i] ;
             }
        $("#chart-legends_car").on('click', "li span[data_leg=3]", function() {
          
          if(ev_click4==false) {
             $(".ul_2 li span[data_leg=3]").addClass("legende_click");
             for(var i = 0 ; i< myChart2.data.datasets[3].data.length ; i++) {
                myChart2.data.datasets[3].data[i] = -10 ;
             }
              myChart2.update();
              ev_click4= !ev_click4 ;
              //alert(ev_click4) ;
          }
          else {
             $(".ul_2 li span[data_leg=3]").removeClass("legende_click");
              for(var i = 0 ; i< myChart2.data.datasets[3].data.length ; i++) {
                myChart2.data.datasets[3].data[i] = tab_temp4[i] ;
             }
              myChart2.update();
              ev_click4= !ev_click4 ;
              //alert(ev_click4) ;
          }
        });

        // fin legende 4



    return myChart2 ;
} 

// responsive pour les chart 

function add_resp_heb(myChart2) {
 

    myChart2.options.scales.yAxes[0].ticks.fontSize = 7 ;
    myChart2.options.scales.yAxes[0].ticks.padding = 10 ;
    myChart2.options.scales.yAxes[0].ticks.stepSize = 20 ;
    myChart2.options.scales.xAxes[0].ticks.stepSize = 0 ;
    myChart2.options.scales.xAxes[0].ticks.fontSize = 8 ;
     for (var i = myChart1.data.datasets.length - 1; i >= 0; i--) {
       myChart1.data.datasets[i].radius = '3' ;
     }
     myChart1.update();
     myChart2.options.scales.yAxes[0].ticks.fontSize = 7 ;
      myChart2.options.scales.xAxes[0].ticks.fontSize = 7 ;
     for (var i = myChart2.data.datasets.length - 1; i >= 0; i--) {
       myChart2.data.datasets[i].radius = '3' ;
     }
     myChart2.update();
}

// tracer 


$(document).ready(function() {
     function generateYear() {
                var today = new Date();
                //alert(today);
                var y = today.getFullYear();
                //alert(y);
                var html = "";
                for (var index = 2009; index < y + 3; index++) {
                    html += "<option value = '" + index + "'>" + index + "</option>";
                }
                $('#annee_pointage').append(html);
            }
            generateYear();
  var w = $(window).width();
  if(w<=768) {
    
      var myChart2 = draw_chart2() ;
      add_resp_heb(myChart1,myChart2) ;
  }
  else {
     
      var myChart2 = draw_chart2() ;
  }

})

  </script>
{% endblock %}
